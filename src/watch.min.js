/**
 * DEVELOPED BY
 * GIL LOPES BUENO
 * gilbueno.mail@gmail.com
 *
 * WORKS WITH:
 * IE8*, IE 9+, FF 4+, SF 5+, WebKit, CH 7+, OP 12+, BESEN, Rhino 1.7+
 * For IE8 (and other legacy browsers) WatchJS will use dirty checking  
 *
 * FORK:
 * https://github.com/melanke/Watch.JS
 *
 * LICENSE: MIT
 */
"use strict";!function(t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(t):(window.WatchJS=t(),window.watch=window.WatchJS.watch,window.unwatch=window.WatchJS.unwatch,window.callWatchers=window.WatchJS.callWatchers)}(function(){var t={noMore:!1,useDirtyCheck:!1,preserveExistingSetters:!1},e=[],n=[],r=[],c=!1;try{c=Object.defineProperty&&Object.defineProperty({},"x",{})}catch(t){}var o=function(t){return t&&"[object Function]"=={}.toString.call(t)},i=function(t){return"[object Array]"===Object.prototype.toString.call(t)},a=function(t){return"[object Object]"==={}.toString.apply(t)},l=function(t){if(null==t||"object"!=typeof t)return t;var e=t.constructor();for(var n in t)e[n]=t[n];return e},s=function(e,n,r,c){try{var o=function(e,n){if(t.preserveExistingSetters)return Object.getOwnPropertyDescriptor(e,n).set}(e,n);Object.defineProperty(e,n,{get:r,set:function(t){c.call(this,t,!0),o&&o(t)},enumerable:!0,configurable:!0})}catch(t){try{Object.prototype.__defineGetter__.call(e,n,r),Object.prototype.__defineSetter__.call(e,n,function(t){c.call(this,t,!0)})}catch(t){u(e,n,c)}}},f=function(t,e,n){try{Object.defineProperty(t,e,{enumerable:!1,configurable:!0,writable:!1,value:n})}catch(r){t[e]=n}},u=function(t,e,r){n[n.length]={prop:e,object:t,orig:l(t[e]),callback:r}},h=function(t,e,n,r){if("string"!=typeof t&&(t instanceof Object||i(t))){if(i(t)){if(P(t,"__watchall__",e,n),void 0===n||n>0)for(var o=0;o<t.length;o++)h(t[o],e,n,r)}else{var a=[];for(o in t)"$val"==o||!c&&"watchers"===o||Object.prototype.hasOwnProperty.call(t,o)&&a.push(o);p(t,a,e,n,r)}r&&T(t,"$$watchlengthsubjectroot",e,n)}},p=function(t,e,n,r,c){if("string"!=typeof t&&(t instanceof Object||i(t)))for(var o=0;o<e.length;o++){var a=e[o];w(t,a,n,r,c)}},w=function(t,e,n,r,c){"string"!=typeof t&&(t instanceof Object||i(t))&&(o(t[e])||(null!=t[e]&&(void 0===r||r>0)&&h(t[e],n,void 0!==r?r-1:r),P(t,e,n,r),c&&(void 0===r||r>0)&&T(t,e,n,r)))},v=function(t,e){if(!(t instanceof String)&&(t instanceof Object||i(t)))if(i(t)){for(var n=["__watchall__"],r=0;r<t.length;r++)n.push(r);d(t,n,e)}else{var c=function(t){var n=[];for(var r in t)t.hasOwnProperty(r)&&(t[r]instanceof Object?c(t[r]):n.push(r));d(t,n,e)};c(t)}},d=function(t,e,n){for(var r in e)e.hasOwnProperty(r)&&$(t,e[r],n)},_=[],g=null;function y(){g=null;for(var t=0;t<_.length;t++)_[t]();_.length=0}var b=function(){return g||(g=setTimeout(y)),g},j=function(t){null==g&&b(),_[_.length]=t},O=function(t,e,n,r){var c=null,o=-1,a=i(t);h(t,function(n,r,i,l){var s=b();if(o!==s&&(o=s,(c={type:"update"}).value=t,c.splices=null,j(function(){e.call(this,c),c=null})),a&&t===this&&null!==c){if("pop"===r||"shift"===r)i=[],l=[l];else if("push"===r||"unshift"===r)i=[i],l=[];else if("splice"!==r)return;c.splices||(c.splices=[]),c.splices[c.splices.length]={index:n,deleteCount:l?l.length:0,addedCount:i?i.length:0,added:i,deleted:l}}},1==n?void 0:0,r)},S=function(t,e,n,r,c){t&&e&&(w(t,e,function(t,e,o,l){var s={type:"update"};s.value=o,s.oldvalue=l,(r&&a(o)||i(o))&&O(o,n,r,c),n.call(this,s)},0),(r&&a(t[e])||i(t[e]))&&O(t[e],n,r,c))},P=function(e,n,r,c){var o=!1,l=i(e);e.watchers||(f(e,"watchers",{}),l&&C(e,function(t,r,o,l){if(M(e,t,r,o,l),0!==c&&o&&(a(o)||i(o))){var s,f,u,p,w=e.watchers[n];for((p=e.watchers.__watchall__)&&(w=w?w.concat(p):p),u=w?w.length:0,s=0;s<u;s++)if("splice"!==r)h(o,w[s],void 0===c?c:c-1);else for(f=0;f<o.length;f++)h(o[f],w[s],void 0===c?c:c-1)}})),e.watchers[n]||(e.watchers[n]=[],l||(o=!0));for(var p=0;p<e.watchers[n].length;p++)if(e.watchers[n][p]===r)return;if(e.watchers[n].push(r),o){var w=e[n],v=function(r,o){var l=w;if(w=r,0!==c&&e[n]&&(a(e[n])||i(e[n]))&&!e[n].watchers){var s,f=e.watchers[n].length;for(s=0;s<f;s++)h(e[n],e.watchers[n][s],void 0===c?c:c-1)}J(e,n)?k(e,n):t.noMore||l!==r&&(o?M(e,n,"set",r,l):m(e,n,"set",r,l),t.noMore=!1)};t.useDirtyCheck?u(e,n,v):s(e,n,function(){return w},v)}},m=function(t,e,n,r,c){if(void 0!==e){var o,i,a=t.watchers[e];(i=t.watchers.__watchall__)&&(a=a?a.concat(i):i),o=a?a.length:0;for(var l=0;l<o;l++)a[l].call(t,e,n,r,c)}else for(var e in t)t.hasOwnProperty(e)&&m(t,e,n,r,c)},W=["pop","push","reverse","shift","sort","slice","unshift","splice"],x=function(t,e,n,r){f(t,n,function(){var c,o,i,a,l=0;if("splice"===n){var s=arguments[0],f=s+arguments[1];for(i=t.slice(s,f),o=[],c=2;c<arguments.length;c++)o[c-2]=arguments[c];l=s}else o=arguments.length>0?arguments[0]:void 0;return a=e.apply(t,arguments),"slice"!==n&&("pop"===n?(i=a,l=t.length):"push"===n?l=t.length-1:"shift"===n?i=a:"unshift"!==n&&void 0===o&&(o=a),r.call(t,l,n,o,i)),a})},C=function(t,e){if(o(e)&&t&&!(t instanceof String)&&i(t))for(var n,r=W.length;r--;)x(t,t[n=W[r]],n,e)},$=function(t,e,n){if(e){if(t.watchers&&t.watchers[e])if(void 0===n)delete t.watchers[e];else for(var r=0;r<t.watchers[e].length;r++){t.watchers[e][r]==n&&t.watchers[e].splice(r,1)}}else delete t.watchers;A(t,e,n),F(t,e)},J=function(t,e){return t.watchers&&(t.watchers.__wjs_suspend__||t.watchers["__wjs_suspend__"+e])},k=function(t,e){j(function(){delete t.watchers.__wjs_suspend__,delete t.watchers["__wjs_suspend__"+e]})},D=null,M=function(t,e,n,c,o){r[r.length]={obj:t,prop:e,mode:n,newval:c,oldval:o},null===D&&(D=setTimeout(E))},E=function(){var t=null;D=null;for(var e=0;e<r.length;e++)t=r[e],m(t.obj,t.prop,t.mode,t.newval,t.oldval);t&&(r=[],t=null)},T=function(t,n,r,c){var o;o=l("$$watchlengthsubjectroot"===n?t:t[n]),e.push({obj:t,prop:n,actual:o,watcher:r,level:c})},A=function(t,n,r){for(var c=0;c<e.length;c++){var o=e[c];o.obj==t&&(n&&o.prop!=n||r&&o.watcher!=r||e.splice(c--,1))}},F=function(t,e){for(var r=0;r<n.length;r++){var c=n[r],o=c.object.watchers;c.object==t&&(!e||c.prop==e)&&o&&(!e||!o[e]||0==o[e].length)&&n.splice(r--,1)}};return t.watch=function(){o(arguments[1])?h.apply(this,arguments):i(arguments[1])?p.apply(this,arguments):w.apply(this,arguments)},t.unwatch=function(){o(arguments[1])?v.apply(this,arguments):i(arguments[1])?d.apply(this,arguments):$.apply(this,arguments)},t.callWatchers=m,t.suspend=function(t,e){if(t.watchers){var n="__wjs_suspend__"+(void 0!==e?e:"");t.watchers[n]=!0}},t.onChange=function(){(o(arguments[2])?S:O).apply(this,arguments)},t});